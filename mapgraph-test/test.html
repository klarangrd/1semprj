<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map graph test</title>
    <!-- Include D3.js and Turf.js libraries -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/@turf/turf@6.3.0"></script>
</head>
<body>
    <h1>Map of the Caribbean</h1>


    <label for="chooseYear"></label>
    <select id="chosenYear">
        <option value="ALL">All</option>
        <option value="2010">2010</option>
    </select>

    <button onclick="selectedYear()">Search</button>

    <button onclick="zoominout(true)">+</button>
    <button onclick="zoominout(false)">-</button>


    <script>
        const w = 1000; // width
        const h = 500;  // height

        let zoom = 1400;
        
       /* function zoominout(zoomin){

            if(zoomin == true && zoom > 300 ){
                zoom += 100 
                console.log("click");
            }
            else if (zoomin == false && zoom < 1400) {
                zoom -= 100
                console.log("click");
            }
        };*/

        const svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h)
            .style("background-color", "lightblue");
      
        Promise.all([
            d3.json("c2.json"),  // Assuming this is your GeoJSON file
            d3.json("http://localhost:3000/kordinater")  // Load external JSON file for bubble data
        ]).then(function (data) {
            const geojson = data[0];
            const bubbleData = data[1].LionfishCloud;

            parseData(bubbleData);
            console.log(bubbleData);

            const projection = d3.geoMercator()
                .center([-75, 18])
                .scale(zoom)
                .translate([w / 2, h / 2]);
            
            const path = d3.geoPath().projection(projection);
           
            svg.selectAll("path")
                .data(geojson.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill", "green");
            
            // Bubble dataset
            svg.selectAll("circle")
                .data(bubbleData)
                .enter()
                .append("circle")
                .attr("cx", d => projection([d.longitude, d.latitude])[0])
                .attr("cy", d => projection([d.longitude, d.latitude])[1])
                .attr("r", 4)
                .style("fill", "red")
                .style("opacity", 0.5)  // Adjust the opacity value as needed
                .on("mouseover", handleMouseOver)
                .on("mouseout", handleMouseOut);
            
            function handleMouseOver(d) {
                svg.append("text")
                    .attr("class", "hover-label")
                    .attr("x", projection([d.longitude, d.latitude])[0])
                    .attr("y", projection([d.longitude, d.latitude])[1] - 10)
                    .text(d.name);
            }

            function handleMouseOut() {
                svg.selectAll(".hover-label").remove();
            }
        });

        function parseData(bubbleData){
            for(n in bubbleData){
        bubbleData [n].latitude = parseFloat(bubbleData [n].latitude);
        bubbleData [n].longitude = parseFloat(bubbleData [n].longitude);
    };//loop to change the type from string to integer*/
        };
    </script>
</body>
</html>
